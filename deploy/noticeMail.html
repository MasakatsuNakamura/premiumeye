<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>サニックスアイズ | 通知メール一覧</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
  </head>
  <body style="margin-top:70px">
    <div style="width:auto" class="container">
      <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container-fluid"></div>
        <div class="navbar-header"><a href="index.html" class="navbar-brand">サニックスアイズ</a></div>
        <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="index.html">PVセンサー一覧</a></li>
            <li><a href="lowGeneration.html">低発電量一覧表</a></li>
            <li><a href="lowGeneration2.html">未復旧故障一覧</a></li>
            <li><a href="abnormalGeneration.html">異常発電量一覧表</a></li>
            <li class="active"><a href="noticeMail.html">通知メール一覧</a></li>
            <li><a href="nameList.html">社員名簿</a></li>
            <li><a href="administrators.html">管理者一覧</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://sanix-eye.jp/7db01ea67f5f30305d9958cce3bc9b48/" target="_blank">サニックスアイ管理ページへ</a></li>
          </ul>
        </div>
      </nav>
      <div style="margin:0 10px 0 10px">
        <div class="form-inline"><a id="yesterday" class="btn btn-default">前日</a><span id="mydate" style="font-size:22px"></span><a id="tommorow" class="btn btn-default">翌日</a></div>
        <div>
          <table class="table">
            <thead>
              <tr>
                <th>日時</th>
                <th>所属</th>
                <th>氏名</th>
                <th>メッセージ</th>
              </tr>
            </thead>
            <tbody id="list"></tbody>
          </table>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script>
          function getUrlVars() {
              var vars = [], hash;
              var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
              for(var i = 0; i < hashes.length; i++)
              {
                  hash = hashes[i].split('=');
                  vars.push(hash[0]);
                  vars[hash[0]] = hash[1];
              }
              return vars;
          };
          
          $(document).ready(function() {
              var args = getUrlVars();
              var date;
              if (args.length == 3) {
                  date = new Date(args['year'], args['month'] - 1, args['day']);
              } else {
                  date = new Date();
              }
            var year = date.getFullYear();
            var month = date.getMonth() + 1;
            month = "0" + month;
            month = month.substr(month.length - 2, 2);
            var mydate = date.getDate();
            mydate = "0" + mydate;
            mydate = mydate.substr(mydate.length - 2, 2);
            var strDate = year + "/" + month + "/" + mydate;
              $('#mydate').text(strDate);
          
              var yesterday = new Date();
              yesterday.setTime(date.getTime() - 86400000);
              $('#yesterday').attr("href", "?year=" + yesterday.getFullYear() + "&month=" + (yesterday.getMonth() + 1) + "&day=" + yesterday.getDate());
              $('#yesterday').text("前日");
          
              var tommorow = new Date();
              tommorow.setTime(date.getTime() + 86400000);
              $('#tommorow').attr("href", "?year=" + tommorow.getFullYear() + "&month=" + (tommorow.getMonth() + 1) + "&day=" + tommorow.getDate());
              $('#tommorow').text("翌日");
          
            $.getJSON("https://s3-ap-northeast-1.amazonaws.com/sanix-data-analysis/fhRK0XGVb3cR1r1S3x9j3j3DRFGUyRYC/administrators.json", function (admin) {
              var hadmin = [];
              for (var i = 0; i < admin.length; i++) {
                hadmin[admin[i]['メールアドレス']] = i;
              }
              $.getJSON("https://s3-ap-northeast-1.amazonaws.com/sanix-data-analysis/fhRK0XGVb3cR1r1S3x9j3j3DRFGUyRYC/noticeMail/" + strDate + ".json", function (json) {
                json.sort(function(val1, val2) {
                  val1 = val1['date'];
                  val2 = val2['date'];
                  if (val1 < val2) {
                    return 1;
                  } else if (val1 > val2) {
                    return -1;
                  } else {
                    return 0;
                  }
                });
                for (var id in json) {
                  if (!json[id]['recipient']) continue;
                  var myadmin = admin[hadmin[json[id]['recipient']]];
                  if (!myadmin) continue;
                  var line = '<tr>';
                  line += '<td>' + json[id]['date'] + '</td>';
                  line += '<td style="text-align:left">' + myadmin['所属'] + '</td>';
                  line += '<td style="text-align:left"><a href="mailto:' + json[id]['recipient'] + '" target="_blank">' + myadmin['name'] + '</td>';
                  line += '<td style="text-align:left"><a href="' + json[id]['url'] + '" target="_blank">' + json[id]['subject'] + '</a></td>';
                  $('#list').append(line);
                }
              });
            });
          });
        </script>
      </div>
    </div>
  </body>
</html>